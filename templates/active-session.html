<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Active Session | ConferenceHub</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="..\static\sessions.css">
</head>
<body>
  <!-- Main content -->
  <main class="main-content">
    <!-- Active Session Content -->
    <div class="card">
      <h3 class="card-title"><i class="fas fa-video"></i> Marketing Strategies for 2025</h3>
      
      <div class="session-layout">
        <div>
          <!-- Chat Panel -->
          <div class="chat-container">
            <div class="chat-messages">
              <div class="message">
                <div class="message-header">
                  <div class="message-avatar">
                    <i class="fas fa-user"></i>
                  </div>
                  <div class="message-name">Sarah Johnson</div>
                  <div class="message-time">10:23 AM</div>
                </div>
                <div class="message-content">
                  Welcome everyone to our marketing strategy session! Today we'll be discussing trends for 2025.
                </div>
              </div>
              
              <div class="message">
                <div class="message-header">
                  <div class="message-avatar">
                    <i class="fas fa-user"></i>
                  </div>
                  <div class="message-name">Michael Brown</div>
                  <div class="message-time">10:25 AM</div>
                </div>
                <div class="message-content">
                  I'm excited to hear about the AI integration strategies you mentioned in the agenda.
                </div>
              </div>
              
              <div class="message">
                <div class="message-header">
                  <div class="message-avatar">
                    <i class="fas fa-user"></i>
                  </div>
                  <div class="message-name">Lisa Chen</div>
                  <div class="message-time">10:26 AM</div>
                </div>
                <div class="message-content">
                  We've been testing some interesting approaches with personalized marketing using the new generative models. I'll share our findings during my segment.
                </div>
              </div>
            </div>
            
            <div class="chat-input-container">
              <input type="text" class="chat-input" placeholder="Type your message...">
              <button class="chat-send">
                <i class="fas fa-paper-plane"></i>
              </button>
            </div>
          </div>
          
          <!-- Q&A Section -->
          <div class="qa-section">
            <h4 class="card-title"><i class="fas fa-question-circle"></i> Q&A</h4>
            
            <div class="qa-item">
              <div class="qa-header">
                <div class="qa-badge">Question</div>
                <div class="qa-name">from David Wilson</div>
              </div>
              <div class="qa-question">
                How do you see privacy regulations affecting personalized marketing in the coming year?
              </div>
              <div class="qa-actions">
                <button class="qa-action">
                  <i class="fas fa-thumbs-up"></i> Upvote (12)
                </button>
                <button class="qa-action">
                  <i class="fas fa-reply"></i> Answer
                </button>
              </div>
            </div>
            
            <div class="qa-item">
              <div class="qa-header">
                <div class="qa-badge">Question</div>
                <div class="qa-name">from Jennifer Park</div>
              </div>
              <div class="qa-question">
                Can you elaborate on the ROI metrics for the immersive technologies mentioned earlier?
              </div>
              <div class="qa-actions">
                <button class="qa-action">
                  <i class="fas fa-thumbs-up"></i> Upvote (8)
                </button>
                <button class="qa-action">
                  <i class="fas fa-reply"></i> Answer
                </button>
              </div>
            </div>
          </div>
          
          <!-- Session Controls -->
          <div class="session-controls">
            <button class="control-button">
              <i class="fas fa-desktop"></i>
              <span>Share</span>
            </button>

            <button class="control-button">
              <i class="fas fa-phone-slash"></i>
              <span>Leave</span>
            </button>
          </div>
        </div>
        
        <!-- Participants List -->
        <div class="card participant-list">
          <h4 class="card-title"><i class="fas fa-users"></i> Participants (12)</h4>
          
          <div class="participant">
            <div class="participant-avatar">
              <i class="fas fa-user"></i>
            </div>
            <div class="participant-info">
              <div class="participant-name">Sarah Johnson</div>
              <div class="participant-role">Host â€¢ Speaking</div>
            </div>
            <button class="participant-actions">
              <i class="fas fa-ellipsis-v"></i>
            </button>
          </div>
          
          <div class="participant">
            <div class="participant-avatar">
              <i class="fas fa-user"></i>
            </div>
            <div class="participant-info">
              <div class="participant-name">Michael Brown</div>
              <div class="participant-role">Co-host</div>
            </div>
            <button class="participant-actions">
              <i class="fas fa-ellipsis-v"></i>
            </button>
          </div>
          
          <div class="participant">
            <div class="participant-avatar">
              <i class="fas fa-user"></i>
            </div>
            <div class="participant-info">
              <div class="participant-name">Lisa Chen</div>
              <div class="participant-role">Speaker</div>
            </div>
            <button class="participant-actions">
              <i class="fas fa-ellipsis-v"></i>
            </button>
          </div>
          
          <div class="participant">
            <div class="participant-avatar">
              <i class="fas fa-user"></i>
            </div>
            <div class="participant-info">
              <div class="participant-name">David Wilson</div>
              <div class="participant-role">Attendee</div>
            </div>
            <button class="participant-actions">
              <i class="fas fa-ellipsis-v"></i>
            </button>
          </div>
          
          <div class="participant">
            <div class="participant-avatar">
              <i class="fas fa-user"></i>
            </div>
            <div class="participant-info">
              <div class="participant-name">Jennifer Park</div>
              <div class="participant-role">Attendee</div>
            </div>
            <button class="participant-actions">
              <i class="fas fa-ellipsis-v"></i>
            </button>
          </div>
          
          <div class="participant">
            <div class="participant-avatar">
              <i class="fas fa-user"></i>
            </div>
            <div class="participant-info">
              <div class="participant-name">Robert Taylor</div>
              <div class="participant-role">Attendee</div>
            </div>
            <button class="participant-actions">
              <i class="fas fa-ellipsis-v"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Mock data structure for backend reference
    const mockSessionData = {
      session: {
        id: "ses_123",
        title: "Marketing Strategies for 2025",
        status: "live",
        startTime: "2024-01-20T10:00:00Z",
        duration: 60,
        participants: [
          {
            id: "usr_1",
            name: "Sarah Johnson",
            role: "host",
            status: "speaking",
            avatar: null
          },
          // ... other participants
        ],
        chat: [
          {
            id: "msg_1",
            userId: "usr_1",
            name: "Sarah Johnson",
            content: "Welcome everyone to our marketing strategy session!",
            timestamp: "2024-01-20T10:23:00Z"
          }
          // ... other messages
        ],
        qa: [
          {
            id: "qa_1",
            userId: "usr_4",
            name: "David Wilson",
            question: "How do you see privacy regulations affecting personalized marketing?",
            upvotes: 12,
            status: "pending"
          }
          // ... other questions
        ]
      }
    };

    /* Required Backend APIs:
     * WS     /ws/session/{sessionId} - WebSocket connection
     * POST   /api/session/message - Send chat message
     * POST   /api/session/question - Submit question
     * PUT    /api/session/upvote/{questionId} - Upvote question
     * POST   /api/session/leave - Leave session
     * PUT    /api/session/status - Update participant status
     */

    // WebSocket connection for real-time updates
    let ws;
    try {
      ws = new WebSocket('ws://localhost:5000/ws/session/123');
      
      ws.onmessage = (event) => {
        const data = JSON.parse(event.data);
        switch(data.type) {
          case 'chat_message':
            appendMessage(data.message);
            break;
          case 'participant_update':
            updateParticipant(data.participant);
            break;
          case 'question_added':
            appendQuestion(data.question);
            break;
          // ... handle other events
        }
      };
    } catch (error) {
      console.error('WebSocket connection failed:', error);
    }

    // Add click handlers for all participant avatars
    document.querySelectorAll('.participant-avatar').forEach(avatar => {
      avatar.style.cursor = 'pointer';
      avatar.addEventListener('click', function() {
        const userName = this.closest('.participant')
          .querySelector('.participant-name').textContent;
        const userId = encodeURIComponent(userName.toLowerCase().replace(' ', '-'));
        window.open(`clicked-profile.html?userId=${userId}`, '_blank');
      });
    });

    // Add click handlers for chat message avatars
    document.querySelectorAll('.message-avatar').forEach(avatar => {
      avatar.style.cursor = 'pointer';
      avatar.addEventListener('click', function() {
        const userName = this.closest('.message')
          .querySelector('.message-name').textContent;
        const userId = encodeURIComponent(userName.toLowerCase().replace(' ', '-'));
        window.open(`clicked-profile.html?userId=${userId}`, '_blank');
      });
    });

    // Add click handlers for Q&A names
    document.querySelectorAll('.qa-name').forEach(nameEl => {
      nameEl.style.cursor = 'pointer';
      nameEl.addEventListener('click', function() {
        const userName = this.textContent.replace('from ', '');
        const userId = encodeURIComponent(userName.toLowerCase().replace(' ', '-'));
        window.open(`clicked-profile.html?userId=${userId}`, '_blank');
      });
    });

    // Chat message handler
    document.querySelector('.chat-send').addEventListener('click', async () => {
      const input = document.querySelector('.chat-input');
      const message = input.value.trim();
      
      if (message) {
        try {
          // @TODO: Replace with actual API call
          // await fetch('/api/session/message', ...);
          input.value = '';
        } catch (error) {
          console.error('Failed to send message:', error);
        }
      }
    });

    // Leave session handler
    document.querySelector('.control-button').addEventListener('click', async () => {
      try {
        // @TODO: Replace with actual API call
        // await fetch('/api/session/leave', ...);
        window.close();
      } catch (error) {
        console.error('Failed to leave session:', error);
      }
    });

    // Clean up WebSocket on page unload
    window.addEventListener('beforeunload', () => {
      if (ws) {
        ws.close();
      }
    });
  </script>
</body>
</html>
